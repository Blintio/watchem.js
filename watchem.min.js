/*
 MIT
  @version 0.4.0
  @author Dumitru Uzun (DUzun.Me)
*/
(function(g,n){function m(){function a(c,a){c in l||(t("tracking ",c,': "'+(a+"").replace(/[\r\n]+/g," ").substr(0,64)+'"'),u.push(c),e[c]&&(D[c]=!0));l[c]=a}k&&x(k);y&&x(y);p&&(h.stopped=+p.watchemStopped||!1);f.href=v.href;var b=E.call(q.scripts||q.querySelectorAll("script[src]")).map(I).filter(J),b=b.concat(K().map(I).filter(J));b.push(v.pathname+v.search.replace(z,""));var d=g.watchemToo,e={};d&&Object.keys(d).forEach(function(a){f.href=a;if(f.hostname!=L)delete d[a];else{var C=f.pathname+f.search.replace(z,
"");d[a]?(b.push(C),e[C]=!0):l[C]=!1}});b.forEach(function(c){c&&(c in l||F("HEAD",c,function(b,d,e){(b=G(e,b))?a(c,b):F("GET",c,function(b,d,e){b=G(e,b);H[c]="GET";a(c,b)})}))});r=0;k=!h.stopped&&500&&w(A,500);y=w(m,5E3);return h}function A(){var a=r,b=u[a];F(H[b]||"HEAD",b,function(d,e,c){e=500;d=G(c,d);if(l[b]!=d)if(t("change detected in ",b,': "'+l[b]+'" != "'+d+'"'),"css"==M(b))c=K(b),c.length?(c=c.pop(),(c.ownerNode||c).href=N(c.href),l[b]=d):B();else{B(D[b]?500:0);return}else r===a&&(++r,r>=
u.length?r=0:e=4);h.stopped||(k&&x(k),k=e&&w(A,e))},function(a,b){h.stopped||B()})}function F(a,b,d,e){return O({url:N(b,a),method:a,headers:P},d,e)}function B(a){a?w(B.bind(n,0)):v.reload()}function J(a){return a}function K(a){for(var b=E.call(q.styleSheets||q.querySelectorAll("link[rel=stylesheet][href]")),d=[],e=0,c;e<b.length;e++)if(c=b[e],c.href)d.push(c);else if(c=c.cssRules)b=b.concat(E.call(c));a&&(f.href=a,a=f.href,d=d.filter(function(b){return(b=b.href)&&0==b.indexOf(a)}));return d}function M(a){f.href=
a;return f.pathname.split(".").pop()}function N(a,b){var d=a.replace(z,"");b&&"HEAD"!=b||(d+=(0>d.indexOf("?")?"?":"&")+"_w_="+((Date.now()||(new Date).getTime())&4194303).toString(36));return d}function I(a){a=a.src||a.href;if(!a)return n;a=M(a);if(f.hostname!=L)return n;if(!(0<f.pathname.indexOf(".min.")))return-1<".css.js".indexOf(a)&&-1==f.pathname.indexOf("/jasmine/lib/")?f.pathname+f.search.replace(z,""):n}function G(a,b){if(a){var d=["Content-Type","Content-Length","Last-Modified","ETag"],
e=[],c,f,g;for(c=d.length;c--;)if(g=a.getResponseHeader(f=d[c])){if("ETag"==f)return g;"Last-Modified"==f&&(g=(new Date(g)/1E3).toString(36));e[c]=g}if(e.length)return e.join("~")}return b}function t(){if(g.console&&console.debug)return h.debug=t=console.debug.bind(console),t.apply(console,arguments)}var P={"X-Requested-With":"Watchem"},q=g.document,v=g.location,L=v.hostname,p=g.localStorage,w=g.setTimeout,x=g.clearTimeout,u=[],D={},l={},H={},h={list:u,extern:D,states:l,types:H,stopped:n,stop:function(){k&&
x(k);k=n;h.stopped=Date.now()||(new Date).getTime();p&&(p.watchemStopped=h.stopped)},start:function(){h.stopped?(delete h.stopped,p&&delete p.watchemStopped,m()):A()},init:m,run:A,debug:t},E=u.slice,f=q.createElement("a"),z=/(\?|\&)_w_=[^\&]+/,r,k,y,O=g.jajax||function(a){if(!a||!a.ajax)throw Error("Watchem: no jAJAX, jQuery or Zepto found!");return function(b,d,e){return a.ajax(b).done(d).fail(e)}}(g.jQuery||g.Zepto);m.version="0.4.0";"function"==typeof define&&define.amd?define([],m):(y=w(m,500),
q.addEventListener("DOMContentLoaded",m),g.watchem=h)})(this);