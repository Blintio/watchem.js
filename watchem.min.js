/*
 MIT
  @version 0.6.1
  @author Dumitru Uzun (DUzun.Me)
*/
(function(h,p){function q(a){l&&z(l);D&&z(D);r&&(k.stopped=+r.watchemStopped||!1);e.href=u.href;var c=E.call(m.scripts||m.querySelectorAll("script[src]")).map(J).filter(K);c=c.concat(L().map(J).filter(K));c.push(u.pathname+u.search.replace(A,""));v(c);a&&v(a,!0);(a=h.watchemToo)&&v(a,!0);t=0;l=!k.stopped&&w(B,500);D=w(q,5E3);return k}function v(a,c){function b(a,b,g){g&&(x("tracking ",a,': "'+(b+"").replace(/[\r\n]+/g," ").substr(0,64)+'"'),c&&(F[a]=!0))}a&&("string"==typeof a&&(a=[a]),Array.isArray(a)?
a.forEach(function(a){(a=M(a))&&N(a,b)}):Object.keys(a).forEach(function(d){var c=M(d);c?a[d]?N(c,b):n[c]=!1:delete a[d]}))}function B(a){a&&v(a,!0);var c=t,b=y[c];G(H[b]||"HEAD",b,function(a,f,g){f=500;a=I(g,a);if(n[b]!=a)if(x("change detected in ",b,': "'+n[b]+'" != "'+a+'"'),"css"==O(b))g=L(b),g.length?(g=g.pop(),(g.ownerNode||g).href=P(g.href),n[b]=a):C();else{C(F[b]?500:0);return}else t===c&&(++t,t>=y.length?t=0:f=4);k.stopped||(l&&z(l),l=f&&w(B,f))},function(a,b){k.stopped||C()})}function G(a,
c,b,d){return Q({url:P(c,a),method:a,headers:T},b,d)}function C(a){a?w(C.bind(p,0)):u.reload()}function K(a){return a}function L(a){for(var c=E.call(m.styleSheets||m.querySelectorAll("link[rel=stylesheet][href]")),b=[],d=0,f;d<c.length;d++)if(f=c[d],f.href)b.push(f);else if(f=f.cssRules)c=c.concat(E.call(f));a&&(e.href=a,a=e.href,b=b.filter(function(b){return(b=b.href)&&0==b.indexOf(a)}));return b}function O(a){e.href=a;return e.pathname.split(".").pop()}function M(a){e.href=a;if(e.hostname==R)return e.pathname+
e.search.replace(A,"")}function P(a,c){var b=a.replace(A,"");c&&"HEAD"!=c||(b+=(0>b.indexOf("?")?"?":"&")+"_w_="+(Date.now()&4194303).toString(36));return b}function J(a){a=a.src||a.href;if(!a)return p;a=O(a);if(e.hostname!=R)return p;if(!(0<e.pathname.indexOf(".min.")))return-1<".css.js".indexOf(a)&&-1==e.pathname.indexOf("/jasmine/lib/")?e.pathname+e.search.replace(A,""):p}function I(a,c){if(a){var b=["Content-Type","Content-Length","Last-Modified","ETag"],d=[],f,g,e;for(f=b.length;f--;)if(e=a.getResponseHeader(g=
b[f])){if("ETag"==g)return e;"Last-Modified"==g&&(e=(new Date(e)/1E3).toString(36));d[f]=e}if(d.length)return d.join("~")}return c}function S(a,c,b){var d=a in n;d||y.push(a);b&&(H[a]=b);n[a]=c;return!d}function N(a,c){if(a&&!(a in n))return G("HEAD",a,function(b,d,e){(b=I(e,b))?c(a,b,S(a,b)):G("GET",a,function(b,d,e){b=I(e,b);c(a,b,S(a,b,"GET"))})})}function x(){var a=h.console;if(a&&a.debug)return x=k.debug=a.debug.bind(a),x.apply(a,arguments)}function U(a,c){var b=m.createElement("SCRIPT");b.async=
1;b.src=a;var d=m.getElementsByTagName("script")[0];b.onload=b.onreadystatechange=function(a){!b||(d=b.readyState)&&"loaded"!=d&&"complete"!=d||!b||(c&&c.call(b,a),b.parentNode&&b.parentNode.removeChild(b),b=p)};d.parentNode.insertBefore(b,d);return b}var T={"X-Requested-With":"Watchem"},m=h.document,u=h.location,R=u.hostname,r=h.localStorage,w=h.setTimeout,z=h.clearTimeout,y=[],F={},n={},H={},k={list:y,extern:F,states:n,types:H,stopped:p,stop:function(){l&&z(l);l=p;k.stopped=Date.now();r&&(r.watchemStopped=
k.stopped)},start:function(a){k.stopped?(delete k.stopped,r&&delete r.watchemStopped,q(a)):B(a)},init:q,run:B,watch:v,debug:x},E=y.slice,e=m.createElement("a"),A=/(\?|\&)_w_=[^\&]+/,t,l,Q=h.jajax||function(a){a&&a.ajax||U("https://cdn.rawgit.com/duzun/jAJAX/master/dist/jajax.1.2.0.min.js",function(){h.jajax&&(Q=h.jajax)});return function(c,b,d){if(!a||!a.ajax)throw Error("Watchem: no jAJAX, jQuery or Zepto found!");return a.ajax(c).done(b).fail(d)}}(h.jQuery||h.Zepto);q.version="0.6.1";if("function"==
typeof define&&define.amd)define([],q);else{var D=w(q,500);m.addEventListener("DOMContentLoaded",q);h.watchem=k}})(this);
