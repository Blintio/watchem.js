/*
 MIT
  @author Dumitru Uzun (DUzun.Me)

*/
(function(f,q){function r(){function b(c,b){c in g||(C("tracking ",c,': "'+(b+"").replace(/[\r\n]+/g," ").substr(0,64)+'"'),s.push(c),h[c]&&(D[c]=!0));g[c]=b}k&&clearTimeout(k);t&&clearTimeout(t);d.href=n.href;var a=E.call(l.scripts||l.querySelectorAll("script[src]")).map(F).filter(function(c){return c});N&&(a=a.concat(G().map(F).filter(function(c){return c})));O&&a.push(n.pathname+n.search.replace(u,""));var e=f.watchemToo,h={};e&&Object.keys(e).forEach(function(c){d.href=c;if(d.hostname!=H)delete e[c];
else{var b=d.pathname+d.search.replace(u,"");e[c]?(a.push(b),h[b]=!0):g[b]=!1}});a.forEach(function(c){c&&(c in g||x({url:v(c,y),type:y,headers:z},function(a,e,h){(a=A(h,a))?b(c,a):x({url:v(c,B),type:B,headers:z},function(a,e,h){a=A(h,a);I[c]=B;b(c,a)})}))});m=0;k=p&&setTimeout(J,p);t=K&&setTimeout(r,K);return g}function J(){var b=m,a=s[b],e=I[a]||y;x({url:v(a,e),type:e,headers:z},function(e,c,d){c=p;e=A(d,e);if(g[a]!=e)if(C("change detected in ",a,': "'+g[a]+'" != "'+e+'"'),"css"==L(a))d=G(a),d.length?
(d=d.pop(),(d.ownerNode||d).href=v(d.href),g[a]=e):w();else{w(D[a]?p:0);return}else m===b&&(++m,m>=s.length?m=0:c=4);k&&clearTimeout(k);k=c&&setTimeout(J,c)},function(b,a){w()})}function w(b){b?setTimeout(w.bind(q,0)):n.reload()}function G(b){var a=E.call(l.styleSheets||l.querySelectorAll("link[rel=stylesheet][href]"));b&&(d.href=b,b=d.href,a=a.filter(function(a){return(a=a.href)&&0==a.indexOf(b)}));return a}function L(b){d.href=b;return d.pathname.split(".").pop()}function v(b,a){var e=b.replace(u,
"");a&&"HEAD"!=a||(e+=(0>e.indexOf("?")?"?":"&")+M+"="+((Date.now()||(new Date).getTime())&4194303).toString(36));return e}function F(b){b=b.src||b.href;if(!b)return q;b=L(b);if(d.hostname!=H)return q;if(!(P&&0<d.pathname.indexOf(".min.")))return-1<".css.js".indexOf(b)&&-1==d.pathname.indexOf("/jasmine/lib/")?d.pathname+d.search.replace(u,""):q}function A(b,a){if(b){var e=["Content-Type","Content-Length","Last-Modified","ETag"],d=[],c,g,f;for(c=e.length;c--;)if(f=b.getResponseHeader(g=e[c])){if("ETag"==
g)return f;"Last-Modified"==g&&(f=(new Date(f)/1E3).toString(36));d[c]=f}if(d.length)return d.join("~")}return a}function C(){return f.console&&console.debug&&console.debug.apply(console,arguments)}var p=500,K=5E3,O=!0,N=!0,P=!0,y="HEAD",B="GET",M="_w_",z={"X-Requested-With":"Watchem"},l=f.document,n=f.location,H=n.hostname,s=[],D={},g={},I={},E=s.slice,d=l.createElement("a"),u=RegExp("(\\?|\\&)"+M+"=[^\\&]+"),m,k,t,x=f.jajax||function(b){return function(a,d,f){return b.ajax(a).done(d).fail(f)}}(f.jQuery||
f.Zepto);"function"==typeof define&&define.amd?define([],r):(t=setTimeout(r,p),l.addEventListener("DOMContentLoaded",r))})(this);
