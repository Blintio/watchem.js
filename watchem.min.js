/*
 MIT
  @version 0.5.0
  @author Dumitru Uzun (DUzun.Me)
*/
(function(g,p){function n(a){k&&z(k);D&&z(D);q&&(h.stopped=+q.watchemStopped||!1);d.href=u.href;var c=E.call(r.scripts||r.querySelectorAll("script[src]")).map(J).filter(K);c=c.concat(L().map(J).filter(K));c.push(u.pathname+u.search.replace(A,""));v(c);a&&v(a,!0);(a=g.watchemToo)&&v(a,!0);t=0;k=!h.stopped&&w(B,500);D=w(n,5E3);return h}function v(a,c){function b(a,b,f){f&&(x("tracking ",a,': "'+(b+"").replace(/[\r\n]+/g," ").substr(0,64)+'"'),c&&(F[a]=!0))}a&&("string"==typeof a&&(a=[a]),Array.isArray(a)?
a.forEach(function(a){(a=M(a))&&N(a,b)}):Object.keys(a).forEach(function(c){var e=M(c);e?a[c]?N(e,b):m[e]=!1:delete a[c]}))}function B(a){a&&v(a,!0);var c=t,b=y[c];G(H[b]||"HEAD",b,function(a,e,f){e=500;a=I(f,a);if(m[b]!=a)if(x("change detected in ",b,': "'+m[b]+'" != "'+a+'"'),"css"==O(b))f=L(b),f.length?(f=f.pop(),(f.ownerNode||f).href=P(f.href),m[b]=a):C();else{C(F[b]?500:0);return}else t===c&&(++t,t>=y.length?t=0:e=4);h.stopped||(k&&z(k),k=e&&w(B,e))},function(a,b){h.stopped||C()})}function G(a,
c,b,l){return S({url:P(c,a),method:a,headers:T},b,l)}function C(a){a?w(C.bind(p,0)):u.reload()}function K(a){return a}function L(a){for(var c=E.call(r.styleSheets||r.querySelectorAll("link[rel=stylesheet][href]")),b=[],l=0,e;l<c.length;l++)if(e=c[l],e.href)b.push(e);else if(e=e.cssRules)c=c.concat(E.call(e));a&&(d.href=a,a=d.href,b=b.filter(function(b){return(b=b.href)&&0==b.indexOf(a)}));return b}function O(a){d.href=a;return d.pathname.split(".").pop()}function M(a){d.href=a;if(d.hostname==Q)return d.pathname+
d.search.replace(A,"")}function P(a,c){var b=a.replace(A,"");c&&"HEAD"!=c||(b+=(0>b.indexOf("?")?"?":"&")+"_w_="+(Date.now()&4194303).toString(36));return b}function J(a){a=a.src||a.href;if(!a)return p;a=O(a);if(d.hostname!=Q)return p;if(!(0<d.pathname.indexOf(".min.")))return-1<".css.js".indexOf(a)&&-1==d.pathname.indexOf("/jasmine/lib/")?d.pathname+d.search.replace(A,""):p}function I(a,c){if(a){var b=["Content-Type","Content-Length","Last-Modified","ETag"],l=[],e,f,d;for(e=b.length;e--;)if(d=a.getResponseHeader(f=
b[e])){if("ETag"==f)return d;"Last-Modified"==f&&(d=(new Date(d)/1E3).toString(36));l[e]=d}if(l.length)return l.join("~")}return c}function R(a,c,b){var d=a in m;d||y.push(a);b&&(H[a]=b);m[a]=c;return!d}function N(a,c){if(a&&!(a in m))return G("HEAD",a,function(b,d,e){(b=I(e,b))?c(a,b,R(a,b)):G("GET",a,function(b,d,e){b=I(e,b);c(a,b,R(a,b,"GET"))})})}function x(){var a=g.console;if(a&&a.debug)return x=h.debug=a.debug.bind(a),x.apply(a,arguments)}var T={"X-Requested-With":"Watchem"},r=g.document,u=
g.location,Q=u.hostname,q=g.localStorage,w=g.setTimeout,z=g.clearTimeout,y=[],F={},m={},H={},h={list:y,extern:F,states:m,types:H,stopped:p,stop:function(){k&&z(k);k=p;h.stopped=Date.now();q&&(q.watchemStopped=h.stopped)},start:function(a){h.stopped?(delete h.stopped,q&&delete q.watchemStopped,n(a)):B(a)},init:n,run:B,watch:v,debug:x},E=y.slice,d=r.createElement("a"),A=/(\?|\&)_w_=[^\&]+/,t,k,S=g.jajax||function(a){if(!a||!a.ajax)throw Error("Watchem: no jAJAX, jQuery or Zepto found!");return function(c,
b,d){return a.ajax(c).done(b).fail(d)}}(g.jQuery||g.Zepto);n.version="0.5.0";if("function"==typeof define&&define.amd)define([],n);else{var D=w(n,500);r.addEventListener("DOMContentLoaded",n);g.watchem=h}})(this);