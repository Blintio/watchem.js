/*
 MIT
  @author Dumitru Uzun (DUzun.Me)

*/
(function(k,r){function p(){function b(a,b){a in f||(C("tracking ",a,': "'+(b+"").replace(/[\r\n]+/g," ").substr(0,64)+'"'),t.push(a),g[a]&&(D[a]=!0));f[a]=b}l&&clearTimeout(l);u&&clearTimeout(u);e.href=q.href;var c=y.call(m.scripts||m.querySelectorAll("script[src]")).map(E).filter(function(a){return a}),c=c.concat(F().map(E).filter(function(a){return a}));c.push(q.pathname+q.search.replace(v,""));var d=k.watchemToo,g={};d&&Object.keys(d).forEach(function(a){e.href=a;if(e.hostname!=G)delete d[a];
else{var b=e.pathname+e.search.replace(v,"");d[a]?(c.push(b),g[b]=!0):f[b]=!1}});c.forEach(function(a){a&&(a in f||z({url:w(a,"HEAD"),type:"HEAD",headers:A},function(c,d,g){(c=B(g,c))?b(a,c):z({url:w(a,"GET"),type:"GET",headers:A},function(c,d,g){c=B(g,c);H[a]="GET";b(a,c)})}))});n=0;l=setTimeout(I,500);u=setTimeout(p,5E3);return f}function I(){var b=n,c=t[b],d=H[c]||"HEAD";z({url:w(c,d),type:d,headers:A},function(d,a,h){a=500;d=B(h,d);if(f[c]!=d)if(C("change detected in ",c,': "'+f[c]+'" != "'+d+
'"'),"css"==J(c))h=F(c),h.length?(h=h.pop(),(h.ownerNode||h).href=w(h.href),f[c]=d):x();else{x(D[c]?500:0);return}else n===b&&(++n,n>=t.length?n=0:a=4);l&&clearTimeout(l);l=a&&setTimeout(I,a)},function(b,a){x()})}function x(b){b?setTimeout(x.bind(r,0)):q.reload()}function F(b){for(var c=y.call(m.styleSheets||m.querySelectorAll("link[rel=stylesheet][href]")),d=[],g=0,a;g<c.length;g++)if(a=c[g],a.href)d.push(a);else if(a=a.cssRules)c=c.concat(y.call(a));b&&(e.href=b,b=e.href,d=d.filter(function(a){return(a=
a.href)&&0==a.indexOf(b)}));return d}function J(b){e.href=b;return e.pathname.split(".").pop()}function w(b,c){var d=b.replace(v,"");c&&"HEAD"!=c||(d+=(0>d.indexOf("?")?"?":"&")+"_w_="+((Date.now()||(new Date).getTime())&4194303).toString(36));return d}function E(b){b=b.src||b.href;if(!b)return r;b=J(b);if(e.hostname!=G)return r;if(!(0<e.pathname.indexOf(".min.")))return-1<".css.js".indexOf(b)&&-1==e.pathname.indexOf("/jasmine/lib/")?e.pathname+e.search.replace(v,""):r}function B(b,c){if(b){var d=
["Content-Type","Content-Length","Last-Modified","ETag"],g=[],a,e,f;for(a=d.length;a--;)if(f=b.getResponseHeader(e=d[a])){if("ETag"==e)return f;"Last-Modified"==e&&(f=(new Date(f)/1E3).toString(36));g[a]=f}if(g.length)return g.join("~")}return c}function C(){return k.console&&console.debug&&console.debug.apply(console,arguments)}var A={"X-Requested-With":"Watchem"},m=k.document,q=k.location,G=q.hostname,t=[],D={},f={},H={},y=t.slice,e=m.createElement("a"),v=/(\?|\&)_w_=[^\&]+/,n,l,u,z=k.jajax||function(b){return function(c,
d,e){return b.ajax(c).done(d).fail(e)}}(k.jQuery||k.Zepto);p.version="0.3.2";"function"==typeof define&&define.amd?define([],p):(u=setTimeout(p,500),m.addEventListener("DOMContentLoaded",p))})(this);