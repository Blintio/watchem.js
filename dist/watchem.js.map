{"version":3,"file":"watchem.js","sources":["../watchem.js"],"sourcesContent":["/**\n *  A very simple, one file script to watches for .js & .css files present in DOM\n *  over AJAX and reload the page or style when changes are detected.\n *\n *  @license MIT\n *  @version 0.7.0\n *  @author Dumitru Uzun (DUzun.Me)\n */\n\n/**\n *  @about\n *\n *  It makes HEAD requests to the server in the specified interval and compares\n *  ETag or Last-Modified headers with the stored value.\n *\n *  If server does not return ETag or Last-Modified headers, it makes\n *  GET requests (which are more expensive) and compares the contents of the file.\n *\n *  Note:\n *     For advanced stuff I recomend http://www.browsersync.io/.\n *     I've built this script to automatically run Jasmine test inside a\n *     Chrome Extension on source files change.\n *\n *  Requires https://github.com/duzun/jAJAX\n *           or jQuery v1.5+\n *           or Zepto v1.1+ with \"callbacks\" and \"deferred\" modules loaded.\n *\n */\n\n/*globals define, globalThis*/\n\n(function (win, undefined) {\n    const version = '0.7.0';\n    const JAJAX_URL = 'https://unpkg.com/jajax.js';\n\n    const noCacheParam = '_w_';\n\n    // Local variables\n    const {\n        document,\n        location,\n        localStorage,\n        setTimeout,\n        clearTimeout,\n        JSON,\n    } = win,\n    { hostname, origin } = location\n\n    ,   list     = []\n    ,   extern   = {}\n    ,   states   = {}\n    ,   types    = {}\n\n    ,   slice    = list.slice\n    ,   a        = document.createElement('a')\n    ,   ncReg    = new RegExp('(\\\\?|\\\\&)'+noCacheParam+'=[^\\\\&]+')\n    ;\n\n    const options = {\n        interval: 700,  // Recheck/ping interval\n        reDOM:    7e3,  // Recheck DOM interval\n\n        wDoc:  true, // Watch this document change\n        wCSS:  true, // Watch CSS change\n        wJS:   true, // Watch JS change\n        noMin: true, // Ignore .min.js or .min.css\n\n        hostAlias: {}, // eg. { 'cdn.example.com': 'example.com', 'www.example.com': 'example.com' }\n\n        wHosts: [hostname], // Automatically watch JS & CSS only for these hostnames\n        // !!! CORS restrictions apply !!!\n\n        // Ping request methods\n        defMethod: 'HEAD',\n        altMethod: 'GET',\n\n        headers: { 'X-Requested-With': 'Watchem' },\n    };\n\n    const watchem  = {\n        list\n      , extern\n      , states\n      , types\n      , options\n\n      , stopped: undefined\n\n      , stop  // stop the watcher\n      , start // start the watcher\n      , init  // init with resources from DOM\n      , run   // one tick of watcher (used internally)\n      , watch // add files to watch\n\n      , setOption\n\n      , saveOptions // to localStorage\n      , loadOptions // from localStorage\n\n      , debug\n    };\n\n    let idx\n    ,   runTo\n    ,   initTo\n    ;\n\n    // Our AJAX method: jajax(options, success, error)\n    let jajax = win.jajax || (function ($) {\n        if ( !($ && $.ajax) ) {\n            debug('Loading ', JAJAX_URL);\n            load_js(JAJAX_URL, () => {\n                setTimeout(() => {\n                    if ( win.jajax ) {\n                        jajax = win.jajax;\n                    }\n                }, 16);\n            });\n        }\n        return (opt, suc, err) => {\n            if ( !($ && $.ajax) ) {\n                throw new Error('Watchem: no jAJAX, jQuery or Zepto found!');\n            }\n            return $.ajax(opt).done(suc).fail(err);\n        };\n    }(win.jQuery||win.Zepto));\n\n    // Implementation functions:\n\n    function init(files) {\n        initTo && clearTimeout(initTo);\n\n        if ( localStorage ) {\n            // Load options only on first run\n            if(runTo == undefined) {\n                loadOptions();\n            }\n            else {\n                watchem.stopped = +localStorage.watchemStopped || false;\n            }\n        }\n\n        a.href = origin;\n\n        let candiates = [];\n\n        if ( options.wCSS ) {\n            candiates = candiates.concat(\n              getStyleSheets().map(filtSrc).filter(identity)\n            );\n        }\n\n        if ( options.wJS ) {\n            candiates = candiates.concat(\n                getScripts().map(filtSrc).filter(identity)\n            );\n        }\n\n        if ( options.wDoc ) {\n            candiates.push(getPath(location));\n        }\n\n        watch(candiates);\n\n        files && !files.type && watch(files, true);\n\n        // Potentially external (to DOM) resources\n        const { watchemToo } = win;\n        if ( watchemToo ) {\n            watch(watchemToo, true);\n        }\n\n        idx = 0;\n        initTo = options.reDOM && setTimeout(init, options.reDOM);\n        runAfter(options.interval);\n\n        return watchem;\n    }\n\n    function watch(files, asExtern) {\n        function add(url, etag, added) {\n            if ( added ) {\n                debug('tracking ', url, ': \"' + (etag+'').replace(/[\\r\\n]+/g,' ').substr(0, 64) + '\"');\n                if ( asExtern ) {\n                    extern[url] = true;\n                }\n            }\n        }\n\n        if ( !files ) return;\n\n        if ( typeof files == 'string' ) {\n            files = [files];\n        }\n\n        if( Array.isArray(files) ) {\n            files.forEach(function (u) {\n                let url = normPath(u);\n                if ( url ) {\n                    getState(url, add);\n                }\n            });\n        }\n        else {\n            Object.keys(files).forEach(function (u) {\n                let url = normPath(u);\n                if ( !url ) {\n                    delete files[u];\n                    return;\n                }\n                if ( files[u] ) {\n                    getState(url, add);\n                }\n                else {\n                    states[url] = false;\n                }\n            });\n        }\n    }\n\n    // Loop through the list of watched resources, asynchronously.\n    function run(files) {\n        if ( files ) {\n            watch(files, true);\n        }\n\n        if(!list.length) return runAfter(options.interval << 1); // no files to watch yet\n\n        let i = idx\n        ,   url = list[i]\n        ,   type = types[url] || options.defMethod\n        ;\n        // debug(type + ':'+idx+':'+url); // for debug\n        request(type, url\n          , function (result, status, xhr) {\n                let _interval = options.interval;\n                const etag = getETag(xhr, result);\n                if ( states[url] != etag ) {\n                    const ext = getExt(url);\n                    debug(`change detected in ${url}: \"${states[url]}\" != \"${etag}\"`);\n                    if ( ext == 'css' ) {\n                        const links = getStyleSheets(url);\n                        if ( links.length ) {\n                            const link = links.pop();\n                            (link.ownerNode || link).href = getNCUrl(link.href);\n                            states[url] = etag;\n                            // _interval = 1e3; // Give it time to load\n                        }\n                        else {\n                            // Can't detect which <link rel=stylesheet /> has changed - reload the whole page\n                            reload();\n                        }\n                    }\n                    else {\n                        // Delay reload for external, giving priority to potentially\n                        // open document with which contains the external url.\n                        reload(extern[url] ? _interval : 0);\n                        _interval = 0;\n                        return;\n                    }\n                }\n                else {\n                    if ( idx === i ) {\n                        ++idx;\n                        if ( idx >= list.length ) {\n                            idx = 0;\n                        }\n                        else {\n                            _interval = 4;\n                        }\n                    }\n                }\n                runAfter(_interval);\n            }\n          , function (xhr, error) {\n                if ( !watchem.stopped ) {\n                    reload();\n                }\n            }\n        );\n    }\n\n    function runAfter(delay) {\n        runTo && clearTimeout(runTo);\n        return runTo = !watchem.stopped && delay && setTimeout(run, delay);\n    }\n\n    function stop() {\n        runTo && clearTimeout(runTo);\n        runTo = undefined;\n        watchem.stopped = now();\n        if ( localStorage ) {\n            localStorage.watchemStopped = watchem.stopped;\n        }\n    }\n\n    function start(files) {\n        if ( watchem.stopped ) {\n            delete watchem.stopped;\n            if ( localStorage ) {\n                delete localStorage.watchemStopped;\n            }\n            init(files);\n        }\n        else {\n            run(files);\n        }\n    }\n\n    function request(method, url, onsuc, onerr) {\n        return jajax(\n            {\n                url: getNCUrl(url, method)\n              , method\n              , headers: options.headers\n              , dataType: 'text'\n              // , crossDomain: true // removes X-Requested-With header\n            }\n          , onsuc\n          , onerr\n        );\n    }\n\n    function reload(delay) {\n        delay\n          ? setTimeout(reload.bind(undefined,0))\n          : location.reload();\n    }\n\n    function setOption(name, value, store) {\n        if(value === undefined && typeof name != 'string') {\n            Object.assign(options, name);\n        }\n        else {\n            options[name] = value;\n        }\n        if ( store ) {\n            saveOptions();\n        }\n    }\n\n    function saveOptions() {\n        if ( localStorage ) {\n            localStorage.watchem = JSON.stringify(options);\n        }\n    }\n\n    function loadOptions() {\n        if ( localStorage ) {\n            watchem.stopped = +localStorage.watchemStopped || false;\n\n            let _options = localStorage.watchem;\n            _options = _options && JSON.parse(_options);\n            if(_options) setOption(_options);\n        }\n    }\n\n    function now() {\n        return Date.now();\n    }\n\n    function identity(val) {\n        return val;\n    }\n\n    function getScripts() {\n        var scripts = slice.call(document.scripts || document.querySelectorAll('script[src]'));\n        return scripts;\n    }\n\n    function getStyleSheets(href) {\n        var _links = slice.call(document.styleSheets || document.querySelectorAll('link[rel=stylesheet][href]'));\n        var links = [];\n        for ( var i = 0, l; i < _links.length; i++ ) {\n            l = _links[i];\n            if ( l.href ) links.push(l);\n            else  // @TODO: track @import from external CSS, avoiding circular @import\n            if ( l = l.cssRules ) {\n                _links = _links.concat( slice.call(l) );\n            }\n        }\n        if ( href ) {\n            a.hostname = hostname; // if href is relative, it should be relative to location\n            a.href = href;\n            href = a.href;\n            const { hostname: _hostname, pathname, search } = a;\n            const hosts = [_hostname];\n            const { hostAlias } = options;\n            const altHostname = hostAlias[_hostname];\n            if(altHostname) hosts.push(altHostname);\n\n            links = links.filter(function (l) {\n                let h = l.href;\n                if(!h) return;\n\n                a.href = h;\n                if(a.pathname != pathname) return;\n                if(search && a.search != search) return;\n\n                const _host = a.hostname;\n                if(!~hosts.indexOf(_host)) {\n                    const altAHostname = hostAlias[_host];\n                    if(!altAHostname || !~hosts.indexOf(altAHostname)) return;\n                }\n\n                return true;\n                // return ( h && h.indexOf(href) == 0 );\n            });\n        }\n        return links;\n    }\n\n    function getExt(url) {\n        a.href = url;\n        var pathname = a.pathname;\n        return pathname.split('.').pop();\n    }\n\n    function getPath(a, withOrigin) {\n        return (withOrigin?a.origin:'') + a.pathname+a.search.replace(ncReg, '');\n    }\n\n    function normPath(url, withOrigin) {\n        a.href = origin; // required for rel url\n        a.href = url;\n        if(withOrigin == undefined) {\n            const { hostAlias } = options;\n            const _host = a.hostname;\n            const _aHost = hostAlias && hostAlias[_host];\n            withOrigin = _host != hostname && (!_aHost || _aHost != hostname);\n        }\n        return getPath(a, withOrigin);\n    }\n\n    function getNCUrl(url, meth) {\n        var href = url.replace(ncReg, '');\n        if ( !meth || meth == 'HEAD' ) {\n            href += (href.indexOf('?') < 0 ? '?' : '&')+noCacheParam+'='+(now()&0x3FFFFF).toString(36);\n        }\n        return href;\n    }\n\n    function filtSrc(l) {\n        const href = l.src || l.href;\n        if ( !href ) return;\n        const ext = getExt(href);\n        const { wHosts, hostAlias } = options;\n\n        let _host = a.hostname;\n        let _aHost = hostAlias && hostAlias[_host];\n        // Unknown host\n        if(wHosts && wHosts.length) {\n            if ( wHosts.indexOf(_host) == -1 && (!_aHost || wHosts.indexOf(_aHost) == -1) ) {\n                return;\n            }\n        }\n        if ( options.noMin && a.pathname.indexOf('.min.') > 0 ) return;\n        return '.css.js'.indexOf(ext) > -1 && a.pathname.indexOf('/jasmine/lib/') == -1\n            ? getPath(a, _host != hostname && (!_aHost || _aHost != hostname))\n            : undefined;\n    }\n\n    function getETag(xhr, result) {\n        if ( xhr ) {\n            var headers = ['Content-Type', 'Content-Length', 'Last-Modified', 'ETag']\n            ,   ret = []\n            ,   i, h, v\n            ;\n            for ( i = headers.length; i--; ) {\n                if ( v = xhr.getResponseHeader(h = headers[i]) ) {\n                    // ETag alone is enough\n                    if ( h == 'ETag' ) {\n                        return v;\n                    }\n                    // Compact Last-Modified for fun and debug\n                    if ( h == 'Last-Modified' ) {\n                        v = (new Date(v) / 1e3).toString(36);\n                    }\n                    ret[i] = v;\n                }\n            }\n            if ( ret.length ) return ret.join('~');\n        }\n        return result;\n    }\n\n\n    function addURL(url, etag, altMethod) {\n        var inState = url in states;\n        if ( !inState ) {\n            list.push(url);\n        }\n        if ( altMethod ) {\n            types[url] = altMethod;\n        }\n        states[url] = etag;\n\n        return !inState;\n    }\n\n    function getState(url, ondone) {\n        if ( !url ) return;\n        if ( !(url in states) ) return request(options.defMethod, url\n          , function (result, status, xhr) {\n                var etag = getETag(xhr, result);\n                if ( !etag ) {\n                    request(options.altMethod, url\n                      , function (result, status, xhr) {\n                            var etag = getETag(xhr, result);\n                            ondone(url, etag, addURL(url, etag, options.altMethod));\n                        }\n                    );\n                }\n                else {\n                    ondone(url, etag, addURL(url, etag));\n                }\n            }\n        );\n    }\n\n    function debug() {\n        const { console } = win;\n        if ( console && console.debug ) {\n            debug = //jshint ignore:line\n            watchem.debug =\n            console.debug.bind(console);\n            return debug.apply(console, arguments);\n        }\n    }\n\n    function load_js(src, clb) {\n        let s = document.createElement('SCRIPT');\n        s.async = 1;\n        s.src = src;\n        let b = document.getElementsByTagName('script')[0];\n        s.onload = s.onreadystatechange = function (evt) {\n            if( s && (!(b=s.readyState)||b=='loaded'||b=='complete') ) {\n                if ( s ) {\n                    clb && clb.call(s, evt);\n                    if ( s.parentNode ) {\n                        s.parentNode.removeChild(s);\n                    }\n                    s = undefined;\n                }\n            }\n        };\n        b.parentNode.insertBefore(s, b);\n        return s;\n    }\n\n    init.version = version;\n\n    // AMD\n    if ( typeof define == 'function' && define.amd) {\n        init.watchem = watchem;\n        define([], init);\n    }\n    // Browser - global scope\n    else {\n        // Init with delay\n        initTo = setTimeout(init, options.interval);\n\n        // Catch new stuff on DOMContentLoaded & window.load\n        if(document.addEventListener) {\n            document.addEventListener('DOMContentLoaded', init);\n            win.addEventListener('load', init);\n        }\n\n        win.watchem = watchem;\n\n        const watchemInit = win.watchemInit;\n        if(watchemInit) watchemInit(watchem, options);\n    }\n}\n(typeof globalThis != 'undefined' ? globalThis : window));\n"],"names":["win","undefined","version","JAJAX_URL","noCacheParam","document","location","localStorage","setTimeout","clearTimeout","JSON","hostname","origin","list","extern","states","types","slice","a","createElement","ncReg","RegExp","options","interval","reDOM","wDoc","wCSS","wJS","noMin","hostAlias","wHosts","defMethod","altMethod","headers","watchem","stopped","stop","start","init","run","watch","setOption","saveOptions","loadOptions","debug","idx","runTo","initTo","jajax","$","ajax","load_js","opt","suc","err","Error","done","fail","jQuery","Zepto","files","watchemStopped","href","candiates","concat","getStyleSheets","map","filtSrc","filter","identity","getScripts","push","getPath","type","watchemToo","runAfter","asExtern","add","url","etag","added","replace","substr","Array","isArray","forEach","u","normPath","getState","Object","keys","length","i","request","result","status","xhr","_interval","getETag","ext","getExt","links","link","pop","ownerNode","getNCUrl","reload","error","delay","now","method","onsuc","onerr","dataType","bind","name","value","store","assign","stringify","_options","parse","Date","val","scripts","call","querySelectorAll","_links","styleSheets","l","cssRules","_hostname","pathname","search","hosts","altHostname","h","_host","indexOf","altAHostname","split","withOrigin","_aHost","meth","toString","src","ret","v","getResponseHeader","join","addURL","inState","ondone","console","apply","arguments","clb","s","async","b","getElementsByTagName","onload","onreadystatechange","evt","readyState","parentNode","removeChild","insertBefore","define","amd","addEventListener","watchemInit","globalThis","window"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAEC,WAAUA,GAAV,EAAeC,WAAf,EAA0B;AACvB,MAAMC,OAAO,GAAG,OAAhB;AACA,MAAMC,SAAS,GAAG,4BAAlB;AAEA,MAAMC,YAAY,GAAG,KAArB,CAJuB;;AAAA,MAQnBC,QARmB,GAcnBL,GAdmB,CAQnBK,QARmB;AAAA,MASnBC,QATmB,GAcnBN,GAdmB,CASnBM,QATmB;AAAA,MAUnBC,YAVmB,GAcnBP,GAdmB,CAUnBO,YAVmB;AAAA,MAWnBC,UAXmB,GAcnBR,GAdmB,CAWnBQ,UAXmB;AAAA,MAYnBC,YAZmB,GAcnBT,GAdmB,CAYnBS,YAZmB;AAAA,MAanBC,IAbmB,GAcnBV,GAdmB,CAanBU,IAbmB;AAAA,MAerBC,QAfqB,GAeAL,QAfA,CAerBK,QAfqB;AAAA,MAeXC,MAfW,GAeAN,QAfA,CAeXM,MAfW;AAAA,MAiBnBC,IAjBmB,GAiBR,EAjBQ;AAAA,MAkBnBC,MAlBmB,GAkBR,EAlBQ;AAAA,MAmBnBC,MAnBmB,GAmBR,EAnBQ;AAAA,MAoBnBC,KApBmB,GAoBR,EApBQ;AAAA,MAsBnBC,KAtBmB,GAsBRJ,IAAI,CAACI,KAtBG;AAAA,MAuBnBC,CAvBmB,GAuBRb,QAAQ,CAACc,aAAT,CAAuB,GAAvB,CAvBQ;AAAA,MAwBnBC,KAxBmB,GAwBR,IAAIC,MAAJ,CAAW,cAAYjB,YAAZ,GAAyB,UAApC,CAxBQ;AA2BvB,MAAMkB,OAAO,GAAG;AACZC,IAAAA,QAAQ,EAAE,GADE;AACI;AAChBC,IAAAA,KAAK,EAAK,GAFE;AAEI;AAEhBC,IAAAA,IAAI,EAAG,IAJK;AAIC;AACbC,IAAAA,IAAI,EAAG,IALK;AAKC;AACbC,IAAAA,GAAG,EAAI,IANK;AAMC;AACbC,IAAAA,KAAK,EAAE,IAPK;AAOC;AAEbC,IAAAA,SAAS,EAAE,EATC;AASG;AAEfC,IAAAA,MAAM,EAAE,CAACnB,QAAD,CAXI;AAWQ;AACpB;AAEA;AACAoB,IAAAA,SAAS,EAAE,MAfC;AAgBZC,IAAAA,SAAS,EAAE,KAhBC;AAkBZC,IAAAA,OAAO,EAAE;AAAE,0BAAoB;AAAtB;AAlBG,GAAhB;AAqBA,MAAMC,OAAO,GAAI;AACbrB,IAAAA,IAAI,EAAJA,IADa;AAEbC,IAAAA,MAAM,EAANA,MAFa;AAGbC,IAAAA,MAAM,EAANA,MAHa;AAIbC,IAAAA,KAAK,EAALA,KAJa;AAKbM,IAAAA,OAAO,EAAPA,OALa;AAOba,IAAAA,OAAO,EAAElC,WAPI;AASbmC,IAAAA,IAAI,EAAJA,IATa;AAAA;AAUbC,IAAAA,KAAK,EAALA,KAVa;AAAA;AAWbC,IAAAA,IAAI,EAAJA,IAXa;AAAA;AAYbC,IAAAA,GAAG,EAAHA,GAZa;AAAA;AAabC,IAAAA,KAAK,EAALA,KAba;AAAA;AAebC,IAAAA,SAAS,EAATA,SAfa;AAiBbC,IAAAA,WAAW,EAAXA,WAjBa;AAAA;AAkBbC,IAAAA,WAAW,EAAXA,WAlBa;AAAA;AAoBbC,IAAAA,KAAK,EAALA;AApBa,GAAjB;AAuBA,MAAIC,GAAJ,EACIC,KADJ,EAEIC,MAFJ,CAvEuB;;AA6EvB,MAAIC,KAAK,GAAGhD,GAAG,CAACgD,KAAJ,IAAc,UAAUC,CAAV,EAAa;AACnC,QAAK,EAAEA,CAAC,IAAIA,CAAC,CAACC,IAAT,CAAL,EAAsB;AAClBN,MAAAA,KAAK,CAAC,UAAD,EAAazC,SAAb,CAAL;AACAgD,MAAAA,OAAO,CAAChD,SAAD,EAAY,YAAM;AACrBK,QAAAA,UAAU,CAAC,YAAM;AACb,cAAKR,GAAG,CAACgD,KAAT,EAAiB;AACbA,YAAAA,KAAK,GAAGhD,GAAG,CAACgD,KAAZ;AACH;AACJ,SAJS,EAIP,EAJO,CAAV;AAKH,OANM,CAAP;AAOH;;AACD,WAAO,UAACI,GAAD,EAAMC,GAAN,EAAWC,GAAX,EAAmB;AACtB,UAAK,EAAEL,CAAC,IAAIA,CAAC,CAACC,IAAT,CAAL,EAAsB;AAClB,cAAM,IAAIK,KAAJ,CAAU,2CAAV,CAAN;AACH;;AACD,aAAON,CAAC,CAACC,IAAF,CAAOE,GAAP,EAAYI,IAAZ,CAAiBH,GAAjB,EAAsBI,IAAtB,CAA2BH,GAA3B,CAAP;AACH,KALD;AAMH,GAjByB,CAiBxBtD,GAAG,CAAC0D,MAAJ,IAAY1D,GAAG,CAAC2D,KAjBQ,CAA1B,CA7EuB;;;AAkGvB,WAASrB,IAAT,CAAcsB,KAAd,EAAqB;AACjBb,IAAAA,MAAM,IAAItC,YAAY,CAACsC,MAAD,CAAtB;;AAEA,QAAKxC,YAAL,EAAoB;AAChB;AACA,UAAGuC,KAAK,IAAI7C,WAAZ,EAAuB;AACnB0C,QAAAA,WAAW;AACd,OAFD,MAGK;AACDT,QAAAA,OAAO,CAACC,OAAR,GAAkB,CAAC5B,YAAY,CAACsD,cAAd,IAAgC,KAAlD;AACH;AACJ;;AAED3C,IAAAA,CAAC,CAAC4C,IAAF,GAASlD,MAAT;AAEA,QAAImD,SAAS,GAAG,EAAhB;;AAEA,QAAKzC,OAAO,CAACI,IAAb,EAAoB;AAChBqC,MAAAA,SAAS,GAAGA,SAAS,CAACC,MAAV,CACVC,cAAc,GAAGC,GAAjB,CAAqBC,OAArB,EAA8BC,MAA9B,CAAqCC,QAArC,CADU,CAAZ;AAGH;;AAED,QAAK/C,OAAO,CAACK,GAAb,EAAmB;AACfoC,MAAAA,SAAS,GAAGA,SAAS,CAACC,MAAV,CACRM,UAAU,GAAGJ,GAAb,CAAiBC,OAAjB,EAA0BC,MAA1B,CAAiCC,QAAjC,CADQ,CAAZ;AAGH;;AAED,QAAK/C,OAAO,CAACG,IAAb,EAAoB;AAChBsC,MAAAA,SAAS,CAACQ,IAAV,CAAeC,OAAO,CAAClE,QAAD,CAAtB;AACH;;AAEDkC,IAAAA,KAAK,CAACuB,SAAD,CAAL;AAEAH,IAAAA,KAAK,IAAI,CAACA,KAAK,CAACa,IAAhB,IAAwBjC,KAAK,CAACoB,KAAD,EAAQ,IAAR,CAA7B,CAnCiB;;AAAA,QAsCTc,UAtCS,GAsCM1E,GAtCN,CAsCT0E,UAtCS;;AAuCjB,QAAKA,UAAL,EAAkB;AACdlC,MAAAA,KAAK,CAACkC,UAAD,EAAa,IAAb,CAAL;AACH;;AAED7B,IAAAA,GAAG,GAAG,CAAN;AACAE,IAAAA,MAAM,GAAGzB,OAAO,CAACE,KAAR,IAAiBhB,UAAU,CAAC8B,IAAD,EAAOhB,OAAO,CAACE,KAAf,CAApC;AACAmD,IAAAA,QAAQ,CAACrD,OAAO,CAACC,QAAT,CAAR;AAEA,WAAOW,OAAP;AACH;;AAED,WAASM,KAAT,CAAeoB,KAAf,EAAsBgB,QAAtB,EAAgC;AAC5B,aAASC,GAAT,CAAaC,GAAb,EAAkBC,IAAlB,EAAwBC,KAAxB,EAA+B;AAC3B,UAAKA,KAAL,EAAa;AACTpC,QAAAA,KAAK,CAAC,WAAD,EAAckC,GAAd,EAAmB,QAAQ,CAACC,IAAI,GAAC,EAAN,EAAUE,OAAV,CAAkB,UAAlB,EAA6B,GAA7B,EAAkCC,MAAlC,CAAyC,CAAzC,EAA4C,EAA5C,CAAR,GAA0D,GAA7E,CAAL;;AACA,YAAKN,QAAL,EAAgB;AACZ9D,UAAAA,MAAM,CAACgE,GAAD,CAAN,GAAc,IAAd;AACH;AACJ;AACJ;;AAED,QAAK,CAAClB,KAAN,EAAc;;AAEd,QAAK,OAAOA,KAAP,IAAgB,QAArB,EAAgC;AAC5BA,MAAAA,KAAK,GAAG,CAACA,KAAD,CAAR;AACH;;AAED,QAAIuB,KAAK,CAACC,OAAN,CAAcxB,KAAd,CAAJ,EAA2B;AACvBA,MAAAA,KAAK,CAACyB,OAAN,CAAc,UAAUC,CAAV,EAAa;AACvB,YAAIR,GAAG,GAAGS,QAAQ,CAACD,CAAD,CAAlB;;AACA,YAAKR,GAAL,EAAW;AACPU,UAAAA,QAAQ,CAACV,GAAD,EAAMD,GAAN,CAAR;AACH;AACJ,OALD;AAMH,KAPD,MAQK;AACDY,MAAAA,MAAM,CAACC,IAAP,CAAY9B,KAAZ,EAAmByB,OAAnB,CAA2B,UAAUC,CAAV,EAAa;AACpC,YAAIR,GAAG,GAAGS,QAAQ,CAACD,CAAD,CAAlB;;AACA,YAAK,CAACR,GAAN,EAAY;AACR,iBAAOlB,KAAK,CAAC0B,CAAD,CAAZ;AACA;AACH;;AACD,YAAK1B,KAAK,CAAC0B,CAAD,CAAV,EAAgB;AACZE,UAAAA,QAAQ,CAACV,GAAD,EAAMD,GAAN,CAAR;AACH,SAFD,MAGK;AACD9D,UAAAA,MAAM,CAAC+D,GAAD,CAAN,GAAc,KAAd;AACH;AACJ,OAZD;AAaH;AACJ,GA3LsB;;;AA8LvB,WAASvC,GAAT,CAAaqB,KAAb,EAAoB;AAChB,QAAKA,KAAL,EAAa;AACTpB,MAAAA,KAAK,CAACoB,KAAD,EAAQ,IAAR,CAAL;AACH;;AAED,QAAG,CAAC/C,IAAI,CAAC8E,MAAT,EAAiB,OAAOhB,QAAQ,CAACrD,OAAO,CAACC,QAAR,IAAoB,CAArB,CAAf,CALD;;AAOhB,QAAIqE,CAAC,GAAG/C,GAAR;AAAA,QACIiC,GAAG,GAAGjE,IAAI,CAAC+E,CAAD,CADd;AAAA,QAEInB,IAAI,GAAGzD,KAAK,CAAC8D,GAAD,CAAL,IAAcxD,OAAO,CAACS,SAFjC,CAPgB;;AAYhB8D,IAAAA,OAAO,CAACpB,IAAD,EAAOK,GAAP,EACH,UAAUgB,MAAV,EAAkBC,MAAlB,EAA0BC,GAA1B,EAA+B;AAC3B,UAAIC,SAAS,GAAG3E,OAAO,CAACC,QAAxB;AACA,UAAMwD,IAAI,GAAGmB,OAAO,CAACF,GAAD,EAAMF,MAAN,CAApB;;AACA,UAAK/E,MAAM,CAAC+D,GAAD,CAAN,IAAeC,IAApB,EAA2B;AACvB,YAAMoB,GAAG,GAAGC,MAAM,CAACtB,GAAD,CAAlB;AACAlC,QAAAA,KAAK,8BAAuBkC,GAAvB,iBAAgC/D,MAAM,CAAC+D,GAAD,CAAtC,qBAAoDC,IAApD,QAAL;;AACA,YAAKoB,GAAG,IAAI,KAAZ,EAAoB;AAChB,cAAME,KAAK,GAAGpC,cAAc,CAACa,GAAD,CAA5B;;AACA,cAAKuB,KAAK,CAACV,MAAX,EAAoB;AAChB,gBAAMW,IAAI,GAAGD,KAAK,CAACE,GAAN,EAAb;AACA,aAACD,IAAI,CAACE,SAAL,IAAkBF,IAAnB,EAAyBxC,IAAzB,GAAgC2C,QAAQ,CAACH,IAAI,CAACxC,IAAN,CAAxC;AACA/C,YAAAA,MAAM,CAAC+D,GAAD,CAAN,GAAcC,IAAd,CAHgB;AAKnB,WALD,MAMK;AACD;AACA2B,YAAAA,MAAM;AACT;AACJ,SAZD,MAaK;AACD;AACA;AACAA,UAAAA,MAAM,CAAC5F,MAAM,CAACgE,GAAD,CAAN,GAAcmB,SAAd,GAA0B,CAA3B,CAAN;AACAA,UAAAA,SAAS,GAAG,CAAZ;AACA;AACH;AACJ,OAvBD,MAwBK;AACD,YAAKpD,GAAG,KAAK+C,CAAb,EAAiB;AACb,YAAE/C,GAAF;;AACA,cAAKA,GAAG,IAAIhC,IAAI,CAAC8E,MAAjB,EAA0B;AACtB9C,YAAAA,GAAG,GAAG,CAAN;AACH,WAFD,MAGK;AACDoD,YAAAA,SAAS,GAAG,CAAZ;AACH;AACJ;AACJ;;AACDtB,MAAAA,QAAQ,CAACsB,SAAD,CAAR;AACH,KAxCE,EAyCH,UAAUD,GAAV,EAAeW,KAAf,EAAsB;AAClB,UAAK,CAACzE,OAAO,CAACC,OAAd,EAAwB;AACpBuE,QAAAA,MAAM;AACT;AACJ,KA7CE,CAAP;AA+CH;;AAED,WAAS/B,QAAT,CAAkBiC,KAAlB,EAAyB;AACrB9D,IAAAA,KAAK,IAAIrC,YAAY,CAACqC,KAAD,CAArB;AACA,WAAOA,KAAK,GAAG,CAACZ,OAAO,CAACC,OAAT,IAAoByE,KAApB,IAA6BpG,UAAU,CAAC+B,GAAD,EAAMqE,KAAN,CAAtD;AACH;;AAED,WAASxE,IAAT,GAAgB;AACZU,IAAAA,KAAK,IAAIrC,YAAY,CAACqC,KAAD,CAArB;AACAA,IAAAA,KAAK,GAAG7C,WAAR;AACAiC,IAAAA,OAAO,CAACC,OAAR,GAAkB0E,GAAG,EAArB;;AACA,QAAKtG,YAAL,EAAoB;AAChBA,MAAAA,YAAY,CAACsD,cAAb,GAA8B3B,OAAO,CAACC,OAAtC;AACH;AACJ;;AAED,WAASE,KAAT,CAAeuB,KAAf,EAAsB;AAClB,QAAK1B,OAAO,CAACC,OAAb,EAAuB;AACnB,aAAOD,OAAO,CAACC,OAAf;;AACA,UAAK5B,YAAL,EAAoB;AAChB,eAAOA,YAAY,CAACsD,cAApB;AACH;;AACDvB,MAAAA,IAAI,CAACsB,KAAD,CAAJ;AACH,KAND,MAOK;AACDrB,MAAAA,GAAG,CAACqB,KAAD,CAAH;AACH;AACJ;;AAED,WAASiC,OAAT,CAAiBiB,MAAjB,EAAyBhC,GAAzB,EAA8BiC,KAA9B,EAAqCC,KAArC,EAA4C;AACxC,WAAOhE,KAAK,CACR;AACI8B,MAAAA,GAAG,EAAE2B,QAAQ,CAAC3B,GAAD,EAAMgC,MAAN,CADjB;AAEIA,MAAAA,MAAM,EAANA,MAFJ;AAGI7E,MAAAA,OAAO,EAAEX,OAAO,CAACW,OAHrB;AAIIgF,MAAAA,QAAQ,EAAE,MAJd;;AAAA,KADQ,EAQRF,KARQ,EASRC,KATQ,CAAZ;AAWH;;AAED,WAASN,MAAT,CAAgBE,KAAhB,EAAuB;AACnBA,IAAAA,KAAK,GACDpG,UAAU,CAACkG,MAAM,CAACQ,IAAP,CAAYjH,WAAZ,EAAsB,CAAtB,CAAD,CADT,GAEDK,QAAQ,CAACoG,MAAT,EAFJ;AAGH;;AAED,WAASjE,SAAT,CAAmB0E,IAAnB,EAAyBC,KAAzB,EAAgCC,KAAhC,EAAuC;AACnC,QAAGD,KAAK,KAAKnH,WAAV,IAAuB,OAAOkH,IAAP,IAAe,QAAzC,EAAmD;AAC/C1B,MAAAA,MAAM,CAAC6B,MAAP,CAAchG,OAAd,EAAuB6F,IAAvB;AACH,KAFD,MAGK;AACD7F,MAAAA,OAAO,CAAC6F,IAAD,CAAP,GAAgBC,KAAhB;AACH;;AACD,QAAKC,KAAL,EAAa;AACT3E,MAAAA,WAAW;AACd;AACJ;;AAED,WAASA,WAAT,GAAuB;AACnB,QAAKnC,YAAL,EAAoB;AAChBA,MAAAA,YAAY,CAAC2B,OAAb,GAAuBxB,IAAI,CAAC6G,SAAL,CAAejG,OAAf,CAAvB;AACH;AACJ;;AAED,WAASqB,WAAT,GAAuB;AACnB,QAAKpC,YAAL,EAAoB;AAChB2B,MAAAA,OAAO,CAACC,OAAR,GAAkB,CAAC5B,YAAY,CAACsD,cAAd,IAAgC,KAAlD;AAEA,UAAI2D,QAAQ,GAAGjH,YAAY,CAAC2B,OAA5B;AACAsF,MAAAA,QAAQ,GAAGA,QAAQ,IAAI9G,IAAI,CAAC+G,KAAL,CAAWD,QAAX,CAAvB;AACA,UAAGA,QAAH,EAAa/E,SAAS,CAAC+E,QAAD,CAAT;AAChB;AACJ;;AAED,WAASX,GAAT,GAAe;AACX,WAAOa,IAAI,CAACb,GAAL,EAAP;AACH;;AAED,WAASxC,QAAT,CAAkBsD,GAAlB,EAAuB;AACnB,WAAOA,GAAP;AACH;;AAED,WAASrD,UAAT,GAAsB;AAClB,QAAIsD,OAAO,GAAG3G,KAAK,CAAC4G,IAAN,CAAWxH,QAAQ,CAACuH,OAAT,IAAoBvH,QAAQ,CAACyH,gBAAT,CAA0B,aAA1B,CAA/B,CAAd;AACA,WAAOF,OAAP;AACH;;AAED,WAAS3D,cAAT,CAAwBH,IAAxB,EAA8B;AAC1B,QAAIiE,MAAM,GAAG9G,KAAK,CAAC4G,IAAN,CAAWxH,QAAQ,CAAC2H,WAAT,IAAwB3H,QAAQ,CAACyH,gBAAT,CAA0B,4BAA1B,CAAnC,CAAb;;AACA,QAAIzB,KAAK,GAAG,EAAZ;;AACA,SAAM,IAAIT,CAAC,GAAG,CAAR,EAAWqC,CAAjB,EAAoBrC,CAAC,GAAGmC,MAAM,CAACpC,MAA/B,EAAuCC,CAAC,EAAxC,EAA6C;AACzCqC,MAAAA,CAAC,GAAGF,MAAM,CAACnC,CAAD,CAAV;AACA,UAAKqC,CAAC,CAACnE,IAAP,EAAcuC,KAAK,CAAC9B,IAAN,CAAW0D,CAAX,EAAd;AAEA,YAAKA,CAAC,GAAGA,CAAC,CAACC,QAAX,EAAsB;AAClBH,UAAAA,MAAM,GAAGA,MAAM,CAAC/D,MAAP,CAAe/C,KAAK,CAAC4G,IAAN,CAAWI,CAAX,CAAf,CAAT;AACH;AACJ;;AACD,QAAKnE,IAAL,EAAY;AACR5C,MAAAA,CAAC,CAACP,QAAF,GAAaA,QAAb,CADQ;;AAERO,MAAAA,CAAC,CAAC4C,IAAF,GAASA,IAAT;AACAA,MAAAA,IAAI,GAAG5C,CAAC,CAAC4C,IAAT;AAHQ,UAIUqE,SAJV,GAI0CjH,CAJ1C,CAIAP,QAJA;AAAA,UAIqByH,QAJrB,GAI0ClH,CAJ1C,CAIqBkH,QAJrB;AAAA,UAI+BC,MAJ/B,GAI0CnH,CAJ1C,CAI+BmH,MAJ/B;AAKR,UAAMC,KAAK,GAAG,CAACH,SAAD,CAAd;AALQ,UAMAtG,SANA,GAMcP,OANd,CAMAO,SANA;AAOR,UAAM0G,WAAW,GAAG1G,SAAS,CAACsG,SAAD,CAA7B;AACA,UAAGI,WAAH,EAAgBD,KAAK,CAAC/D,IAAN,CAAWgE,WAAX;AAEhBlC,MAAAA,KAAK,GAAGA,KAAK,CAACjC,MAAN,CAAa,UAAU6D,CAAV,EAAa;AAC9B,YAAIO,CAAC,GAAGP,CAAC,CAACnE,IAAV;AACA,YAAG,CAAC0E,CAAJ,EAAO;AAEPtH,QAAAA,CAAC,CAAC4C,IAAF,GAAS0E,CAAT;AACA,YAAGtH,CAAC,CAACkH,QAAF,IAAcA,QAAjB,EAA2B;AAC3B,YAAGC,MAAM,IAAInH,CAAC,CAACmH,MAAF,IAAYA,MAAzB,EAAiC;AAEjC,YAAMI,KAAK,GAAGvH,CAAC,CAACP,QAAhB;;AACA,YAAG,CAAC,CAAC2H,KAAK,CAACI,OAAN,CAAcD,KAAd,CAAL,EAA2B;AACvB,cAAME,YAAY,GAAG9G,SAAS,CAAC4G,KAAD,CAA9B;AACA,cAAG,CAACE,YAAD,IAAiB,CAAC,CAACL,KAAK,CAACI,OAAN,CAAcC,YAAd,CAAtB,EAAmD;AACtD;;AAED,eAAO,IAAP,CAd8B;AAgBjC,OAhBO,CAAR;AAiBH;;AACD,WAAOtC,KAAP;AACH;;AAED,WAASD,MAAT,CAAgBtB,GAAhB,EAAqB;AACjB5D,IAAAA,CAAC,CAAC4C,IAAF,GAASgB,GAAT;AACA,QAAIsD,QAAQ,GAAGlH,CAAC,CAACkH,QAAjB;AACA,WAAOA,QAAQ,CAACQ,KAAT,CAAe,GAAf,EAAoBrC,GAApB,EAAP;AACH;;AAED,WAAS/B,OAAT,CAAiBtD,CAAjB,EAAoB2H,UAApB,EAAgC;AAC5B,WAAO,CAACA,UAAU,GAAC3H,CAAC,CAACN,MAAH,GAAU,EAArB,IAA2BM,CAAC,CAACkH,QAA7B,GAAsClH,CAAC,CAACmH,MAAF,CAASpD,OAAT,CAAiB7D,KAAjB,EAAwB,EAAxB,CAA7C;AACH;;AAED,WAASmE,QAAT,CAAkBT,GAAlB,EAAuB+D,UAAvB,EAAmC;AAC/B3H,IAAAA,CAAC,CAAC4C,IAAF,GAASlD,MAAT,CAD+B;;AAE/BM,IAAAA,CAAC,CAAC4C,IAAF,GAASgB,GAAT;;AACA,QAAG+D,UAAU,IAAI5I,WAAjB,EAA4B;AAAA,UAChB4B,SADgB,GACFP,OADE,CAChBO,SADgB;AAExB,UAAM4G,KAAK,GAAGvH,CAAC,CAACP,QAAhB;;AACA,UAAMmI,MAAM,GAAGjH,SAAS,IAAIA,SAAS,CAAC4G,KAAD,CAArC;;AACAI,MAAAA,UAAU,GAAGJ,KAAK,IAAI9H,QAAT,KAAsB,CAACmI,MAAD,IAAWA,MAAM,IAAInI,QAA3C,CAAb;AACH;;AACD,WAAO6D,OAAO,CAACtD,CAAD,EAAI2H,UAAJ,CAAd;AACH;;AAED,WAASpC,QAAT,CAAkB3B,GAAlB,EAAuBiE,IAAvB,EAA6B;AACzB,QAAIjF,IAAI,GAAGgB,GAAG,CAACG,OAAJ,CAAY7D,KAAZ,EAAmB,EAAnB,CAAX;;AACA,QAAK,CAAC2H,IAAD,IAASA,IAAI,IAAI,MAAtB,EAA+B;AAC3BjF,MAAAA,IAAI,IAAI,CAACA,IAAI,CAAC4E,OAAL,CAAa,GAAb,IAAoB,CAApB,GAAwB,GAAxB,GAA8B,GAA/B,IAAoCtI,YAApC,GAAiD,GAAjD,GAAqD,CAACyG,GAAG,KAAG,QAAP,EAAiBmC,QAAjB,CAA0B,EAA1B,CAA7D;AACH;;AACD,WAAOlF,IAAP;AACH;;AAED,WAASK,OAAT,CAAiB8D,CAAjB,EAAoB;AAChB,QAAMnE,IAAI,GAAGmE,CAAC,CAACgB,GAAF,IAAShB,CAAC,CAACnE,IAAxB;AACA,QAAK,CAACA,IAAN,EAAa;AACb,QAAMqC,GAAG,GAAGC,MAAM,CAACtC,IAAD,CAAlB;AAHgB,QAIRhC,MAJQ,GAIcR,OAJd,CAIRQ,MAJQ;AAAA,QAIAD,SAJA,GAIcP,OAJd,CAIAO,SAJA;AAMhB,QAAI4G,KAAK,GAAGvH,CAAC,CAACP,QAAd;;AACA,QAAImI,MAAM,GAAGjH,SAAS,IAAIA,SAAS,CAAC4G,KAAD,CAAnC,CAPgB;;;AAShB,QAAG3G,MAAM,IAAIA,MAAM,CAAC6D,MAApB,EAA4B;AACxB,UAAK7D,MAAM,CAAC4G,OAAP,CAAeD,KAAf,KAAyB,CAAC,CAA1B,KAAgC,CAACK,MAAD,IAAWhH,MAAM,CAAC4G,OAAP,CAAeI,MAAf,KAA0B,CAAC,CAAtE,CAAL,EAAgF;AAC5E;AACH;AACJ;;AACD,QAAKxH,OAAO,CAACM,KAAR,IAAiBV,CAAC,CAACkH,QAAF,CAAWM,OAAX,CAAmB,OAAnB,IAA8B,CAApD,EAAwD;AACxD,WAAO,UAAUA,OAAV,CAAkBvC,GAAlB,IAAyB,CAAC,CAA1B,IAA+BjF,CAAC,CAACkH,QAAF,CAAWM,OAAX,CAAmB,eAAnB,KAAuC,CAAC,CAAvE,GACDlE,OAAO,CAACtD,CAAD,EAAIuH,KAAK,IAAI9H,QAAT,KAAsB,CAACmI,MAAD,IAAWA,MAAM,IAAInI,QAA3C,CAAJ,CADN,GAEDV,WAFN;AAGH;;AAED,WAASiG,OAAT,CAAiBF,GAAjB,EAAsBF,MAAtB,EAA8B;AAC1B,QAAKE,GAAL,EAAW;AACP,UAAI/D,OAAO,GAAG,CAAC,cAAD,EAAiB,gBAAjB,EAAmC,eAAnC,EAAoD,MAApD,CAAd;AAAA,UACIiH,GAAG,GAAG,EADV;AAAA,UAEItD,CAFJ;AAAA,UAEO4C,CAFP;AAAA,UAEUW,CAFV;;AAIA,WAAMvD,CAAC,GAAG3D,OAAO,CAAC0D,MAAlB,EAA0BC,CAAC,EAA3B,GAAiC;AAC7B,YAAKuD,CAAC,GAAGnD,GAAG,CAACoD,iBAAJ,CAAsBZ,CAAC,GAAGvG,OAAO,CAAC2D,CAAD,CAAjC,CAAT,EAAiD;AAC7C;AACA,cAAK4C,CAAC,IAAI,MAAV,EAAmB;AACf,mBAAOW,CAAP;AACH,WAJ4C;;;AAM7C,cAAKX,CAAC,IAAI,eAAV,EAA4B;AACxBW,YAAAA,CAAC,GAAG,CAAC,IAAIzB,IAAJ,CAASyB,CAAT,IAAc,GAAf,EAAoBH,QAApB,CAA6B,EAA7B,CAAJ;AACH;;AACDE,UAAAA,GAAG,CAACtD,CAAD,CAAH,GAASuD,CAAT;AACH;AACJ;;AACD,UAAKD,GAAG,CAACvD,MAAT,EAAkB,OAAOuD,GAAG,CAACG,IAAJ,CAAS,GAAT,CAAP;AACrB;;AACD,WAAOvD,MAAP;AACH;;AAGD,WAASwD,MAAT,CAAgBxE,GAAhB,EAAqBC,IAArB,EAA2B/C,SAA3B,EAAsC;AAClC,QAAIuH,OAAO,IAAGzE,GAAG,IAAI/D,MAAV,CAAX;;AACA,QAAK,CAACwI,OAAN,EAAgB;AACZ1I,MAAAA,IAAI,CAAC0D,IAAL,CAAUO,GAAV;AACH;;AACD,QAAK9C,SAAL,EAAiB;AACbhB,MAAAA,KAAK,CAAC8D,GAAD,CAAL,GAAa9C,SAAb;AACH;;AACDjB,IAAAA,MAAM,CAAC+D,GAAD,CAAN,GAAcC,IAAd;AAEA,WAAO,CAACwE,OAAR;AACH;;AAED,WAAS/D,QAAT,CAAkBV,GAAlB,EAAuB0E,MAAvB,EAA+B;AAC3B,QAAK,CAAC1E,GAAN,EAAY;AACZ,QAAK,EAAEA,GAAG,IAAI/D,MAAT,CAAL,EAAwB,OAAO8E,OAAO,CAACvE,OAAO,CAACS,SAAT,EAAoB+C,GAApB,EAClC,UAAUgB,MAAV,EAAkBC,MAAlB,EAA0BC,GAA1B,EAA+B;AAC3B,UAAIjB,IAAI,GAAGmB,OAAO,CAACF,GAAD,EAAMF,MAAN,CAAlB;;AACA,UAAK,CAACf,IAAN,EAAa;AACTc,QAAAA,OAAO,CAACvE,OAAO,CAACU,SAAT,EAAoB8C,GAApB,EACH,UAAUgB,MAAV,EAAkBC,MAAlB,EAA0BC,GAA1B,EAA+B;AAC3B,cAAIjB,IAAI,GAAGmB,OAAO,CAACF,GAAD,EAAMF,MAAN,CAAlB;AACA0D,UAAAA,MAAM,CAAC1E,GAAD,EAAMC,IAAN,EAAYuE,MAAM,CAACxE,GAAD,EAAMC,IAAN,EAAYzD,OAAO,CAACU,SAApB,CAAlB,CAAN;AACH,SAJE,CAAP;AAMH,OAPD,MAQK;AACDwH,QAAAA,MAAM,CAAC1E,GAAD,EAAMC,IAAN,EAAYuE,MAAM,CAACxE,GAAD,EAAMC,IAAN,CAAlB,CAAN;AACH;AACJ,KAdiC,CAAd;AAgB3B;;AAED,WAASnC,KAAT,GAAiB;AAAA,QACL6G,OADK,GACOzJ,GADP,CACLyJ,OADK;;AAEb,QAAKA,OAAO,IAAIA,OAAO,CAAC7G,KAAxB,EAAgC;AAC5BA,MAAAA,KAAK;AACLV,MAAAA,OAAO,CAACU,KAAR,GACA6G,OAAO,CAAC7G,KAAR,CAAcsE,IAAd,CAAmBuC,OAAnB,CAFA;AAGA,aAAO7G,KAAK,CAAC8G,KAAN,CAAYD,OAAZ,EAAqBE,SAArB,CAAP;AACH;AACJ;;AAED,WAASxG,OAAT,CAAiB8F,GAAjB,EAAsBW,GAAtB,EAA2B;AACvB,QAAIC,CAAC,GAAGxJ,QAAQ,CAACc,aAAT,CAAuB,QAAvB,CAAR;AACA0I,IAAAA,CAAC,CAACC,KAAF,GAAU,CAAV;AACAD,IAAAA,CAAC,CAACZ,GAAF,GAAQA,GAAR;AACA,QAAIc,CAAC,GAAG1J,QAAQ,CAAC2J,oBAAT,CAA8B,QAA9B,EAAwC,CAAxC,CAAR;;AACAH,IAAAA,CAAC,CAACI,MAAF,GAAWJ,CAAC,CAACK,kBAAF,GAAuB,UAAUC,GAAV,EAAe;AAC7C,UAAIN,CAAC,KAAK,EAAEE,CAAC,GAACF,CAAC,CAACO,UAAN,KAAmBL,CAAC,IAAE,QAAtB,IAAgCA,CAAC,IAAE,UAAxC,CAAL,EAA2D;AACvD,YAAKF,CAAL,EAAS;AACLD,UAAAA,GAAG,IAAIA,GAAG,CAAC/B,IAAJ,CAASgC,CAAT,EAAYM,GAAZ,CAAP;;AACA,cAAKN,CAAC,CAACQ,UAAP,EAAoB;AAChBR,YAAAA,CAAC,CAACQ,UAAF,CAAaC,WAAb,CAAyBT,CAAzB;AACH;;AACDA,UAAAA,CAAC,GAAG5J,WAAJ;AACH;AACJ;AACJ,KAVD;;AAWA8J,IAAAA,CAAC,CAACM,UAAF,CAAaE,YAAb,CAA0BV,CAA1B,EAA6BE,CAA7B;AACA,WAAOF,CAAP;AACH;;AAEDvH,EAAAA,IAAI,CAACpC,OAAL,GAAeA,OAAf,CAvgBuB;;AA0gBvB,MAAK,OAAOsK,MAAP,IAAiB,UAAjB,IAA+BA,MAAM,CAACC,GAA3C,EAAgD;AAC5CnI,IAAAA,IAAI,CAACJ,OAAL,GAAeA,OAAf;AACAsI,IAAAA,MAAM,CAAC,EAAD,EAAKlI,IAAL,CAAN;AACH,GAHD;AAAA,OAKK;AACD;AACAS,MAAAA,MAAM,GAAGvC,UAAU,CAAC8B,IAAD,EAAOhB,OAAO,CAACC,QAAf,CAAnB,CAFC;;AAKD,UAAGlB,QAAQ,CAACqK,gBAAZ,EAA8B;AAC1BrK,QAAAA,QAAQ,CAACqK,gBAAT,CAA0B,kBAA1B,EAA8CpI,IAA9C;AACAtC,QAAAA,GAAG,CAAC0K,gBAAJ,CAAqB,MAArB,EAA6BpI,IAA7B;AACH;;AAEDtC,MAAAA,GAAG,CAACkC,OAAJ,GAAcA,OAAd;AAEA,UAAMyI,WAAW,GAAG3K,GAAG,CAAC2K,WAAxB;AACA,UAAGA,WAAH,EAAgBA,WAAW,CAACzI,OAAD,EAAUZ,OAAV,CAAX;AACnB;AACJ,CA9hBA,EA+hBA,OAAOsJ,UAAP,IAAqB,WAArB,GAAmCA,UAAnC,GAAgDC,MA/hBhD,CAAD"}