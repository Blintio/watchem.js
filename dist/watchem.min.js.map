{"version":3,"file":"watchem.min.js","sources":["../watchem.js"],"sourcesContent":["/**\n *  A very simple, one file script to watches for .js & .css files present in DOM\n *  over AJAX and reload the page or style when changes are detected.\n *\n *  @license MIT\n *  @version 0.7.0\n *  @author Dumitru Uzun (DUzun.Me)\n */\n\n/**\n *  @about\n *\n *  It makes HEAD requests to the server in the specified interval and compares\n *  ETag or Last-Modified headers with the stored value.\n *\n *  If server does not return ETag or Last-Modified headers, it makes\n *  GET requests (which are more expensive) and compares the contents of the file.\n *\n *  Note:\n *     For advanced stuff I recomend http://www.browsersync.io/.\n *     I've built this script to automatically run Jasmine test inside a\n *     Chrome Extension on source files change.\n *\n *  Requires https://github.com/duzun/jAJAX\n *           or jQuery v1.5+\n *           or Zepto v1.1+ with \"callbacks\" and \"deferred\" modules loaded.\n *\n */\n\n/*globals define, globalThis*/\n\n(function (win, undefined) {\n    const version = '0.7.0';\n    const JAJAX_URL = 'https://unpkg.com/jajax.js';\n\n    const noCacheParam = '_w_';\n\n    // Local variables\n    const {\n        document,\n        location,\n        localStorage,\n        setTimeout,\n        clearTimeout,\n        JSON,\n    } = win,\n    { hostname, origin } = location\n\n    ,   list     = []\n    ,   extern   = {}\n    ,   states   = {}\n    ,   types    = {}\n\n    ,   slice    = list.slice\n    ,   a        = document.createElement('a')\n    ,   ncReg    = new RegExp('(\\\\?|\\\\&)'+noCacheParam+'=[^\\\\&]+')\n    ;\n\n    const options = {\n        interval: 700,  // Recheck/ping interval\n        reDOM:    7e3,  // Recheck DOM interval\n\n        wDoc:  true, // Watch this document change\n        wCSS:  true, // Watch CSS change\n        wJS:   true, // Watch JS change\n        noMin: true, // Ignore .min.js or .min.css\n\n        hostAlias: {}, // eg. { 'cdn.example.com': 'example.com', 'www.example.com': 'example.com' }\n\n        wHosts: [hostname], // Automatically watch JS & CSS only for these hostnames\n        // !!! CORS restrictions apply !!!\n\n        // Ping request methods\n        defMethod: 'HEAD',\n        altMethod: 'GET',\n\n        headers: { 'X-Requested-With': 'Watchem' },\n    };\n\n    const watchem  = {\n        list\n      , extern\n      , states\n      , types\n      , options\n\n      , stopped: undefined\n\n      , stop  // stop the watcher\n      , start // start the watcher\n      , init  // init with resources from DOM\n      , run   // one tick of watcher (used internally)\n      , watch // add files to watch\n\n      , setOption\n\n      , saveOptions // to localStorage\n      , loadOptions // from localStorage\n\n      , debug\n    };\n\n    let idx\n    ,   runTo\n    ,   initTo\n    ;\n\n    // Our AJAX method: jajax(options, success, error)\n    let jajax = win.jajax || (function ($) {\n        if ( !($ && $.ajax) ) {\n            debug('Loading ', JAJAX_URL);\n            load_js(JAJAX_URL, () => {\n                setTimeout(() => {\n                    if ( win.jajax ) {\n                        jajax = win.jajax;\n                    }\n                }, 16);\n            });\n        }\n        return (opt, suc, err) => {\n            if ( !($ && $.ajax) ) {\n                throw new Error('Watchem: no jAJAX, jQuery or Zepto found!');\n            }\n            return $.ajax(opt).done(suc).fail(err);\n        };\n    }(win.jQuery||win.Zepto));\n\n    // Implementation functions:\n\n    function init(files) {\n        initTo && clearTimeout(initTo);\n\n        if ( localStorage ) {\n            // Load options only on first run\n            if(runTo == undefined) {\n                loadOptions();\n            }\n            else {\n                watchem.stopped = +localStorage.watchemStopped || false;\n            }\n        }\n\n        a.href = origin;\n\n        let candiates = [];\n\n        if ( options.wCSS ) {\n            candiates = candiates.concat(\n              getStyleSheets().map(filtSrc).filter(identity)\n            );\n        }\n\n        if ( options.wJS ) {\n            candiates = candiates.concat(\n                getScripts().map(filtSrc).filter(identity)\n            );\n        }\n\n        if ( options.wDoc ) {\n            candiates.push(getPath(location));\n        }\n\n        watch(candiates);\n\n        files && !files.type && watch(files, true);\n\n        // Potentially external (to DOM) resources\n        const { watchemToo } = win;\n        if ( watchemToo ) {\n            watch(watchemToo, true);\n        }\n\n        idx = 0;\n        initTo = options.reDOM && setTimeout(init, options.reDOM);\n        runAfter(options.interval);\n\n        return watchem;\n    }\n\n    function watch(files, asExtern) {\n        function add(url, etag, added) {\n            if ( added ) {\n                debug('tracking ', url, ': \"' + (etag+'').replace(/[\\r\\n]+/g,' ').substr(0, 64) + '\"');\n                if ( asExtern ) {\n                    extern[url] = true;\n                }\n            }\n        }\n\n        if ( !files ) return;\n\n        if ( typeof files == 'string' ) {\n            files = [files];\n        }\n\n        if( Array.isArray(files) ) {\n            files.forEach(function (u) {\n                let url = normPath(u);\n                if ( url ) {\n                    getState(url, add);\n                }\n            });\n        }\n        else {\n            Object.keys(files).forEach(function (u) {\n                let url = normPath(u);\n                if ( !url ) {\n                    delete files[u];\n                    return;\n                }\n                if ( files[u] ) {\n                    getState(url, add);\n                }\n                else {\n                    states[url] = false;\n                }\n            });\n        }\n    }\n\n    // Loop through the list of watched resources, asynchronously.\n    function run(files) {\n        if ( files ) {\n            watch(files, true);\n        }\n\n        if(!list.length) return runAfter(options.interval << 1); // no files to watch yet\n\n        let i = idx\n        ,   url = list[i]\n        ,   type = types[url] || options.defMethod\n        ;\n        // debug(type + ':'+idx+':'+url); // for debug\n        request(type, url\n          , function (result, status, xhr) {\n                let _interval = options.interval;\n                const etag = getETag(xhr, result);\n                if ( states[url] != etag ) {\n                    const ext = getExt(url);\n                    debug(`change detected in ${url}: \"${states[url]}\" != \"${etag}\"`);\n                    if ( ext == 'css' ) {\n                        const links = getStyleSheets(url);\n                        if ( links.length ) {\n                            const link = links.pop();\n                            (link.ownerNode || link).href = getNCUrl(link.href);\n                            states[url] = etag;\n                            // _interval = 1e3; // Give it time to load\n                        }\n                        else {\n                            // Can't detect which <link rel=stylesheet /> has changed - reload the whole page\n                            reload();\n                        }\n                    }\n                    else {\n                        // Delay reload for external, giving priority to potentially\n                        // open document with which contains the external url.\n                        reload(extern[url] ? _interval : 0);\n                        _interval = 0;\n                        return;\n                    }\n                }\n                else {\n                    if ( idx === i ) {\n                        ++idx;\n                        if ( idx >= list.length ) {\n                            idx = 0;\n                        }\n                        else {\n                            _interval = 4;\n                        }\n                    }\n                }\n                runAfter(_interval);\n            }\n          , function (xhr, error) {\n                if ( !watchem.stopped ) {\n                    reload();\n                }\n            }\n        );\n    }\n\n    function runAfter(delay) {\n        runTo && clearTimeout(runTo);\n        return runTo = !watchem.stopped && delay && setTimeout(run, delay);\n    }\n\n    function stop() {\n        runTo && clearTimeout(runTo);\n        runTo = undefined;\n        watchem.stopped = now();\n        if ( localStorage ) {\n            localStorage.watchemStopped = watchem.stopped;\n        }\n    }\n\n    function start(files) {\n        if ( watchem.stopped ) {\n            delete watchem.stopped;\n            if ( localStorage ) {\n                delete localStorage.watchemStopped;\n            }\n            init(files);\n        }\n        else {\n            run(files);\n        }\n    }\n\n    function request(method, url, onsuc, onerr) {\n        return jajax(\n            {\n                url: getNCUrl(url, method)\n              , method\n              , headers: options.headers\n              , dataType: 'text'\n              // , crossDomain: true // removes X-Requested-With header\n            }\n          , onsuc\n          , onerr\n        );\n    }\n\n    function reload(delay) {\n        delay\n          ? setTimeout(reload.bind(undefined,0))\n          : location.reload();\n    }\n\n    function setOption(name, value, store) {\n        if(value === undefined && typeof name != 'string') {\n            Object.assign(options, name);\n        }\n        else {\n            options[name] = value;\n        }\n        if ( store ) {\n            saveOptions();\n        }\n    }\n\n    function saveOptions() {\n        if ( localStorage ) {\n            localStorage.watchem = JSON.stringify(options);\n        }\n    }\n\n    function loadOptions() {\n        if ( localStorage ) {\n            watchem.stopped = +localStorage.watchemStopped || false;\n\n            let _options = localStorage.watchem;\n            _options = _options && JSON.parse(_options);\n            if(_options) setOption(_options);\n        }\n    }\n\n    function now() {\n        return Date.now();\n    }\n\n    function identity(val) {\n        return val;\n    }\n\n    function getScripts() {\n        var scripts = slice.call(document.scripts || document.querySelectorAll('script[src]'));\n        return scripts;\n    }\n\n    function getStyleSheets(href) {\n        var _links = slice.call(document.styleSheets || document.querySelectorAll('link[rel=stylesheet][href]'));\n        var links = [];\n        for ( var i = 0, l; i < _links.length; i++ ) {\n            l = _links[i];\n            if ( l.href ) links.push(l);\n            else  // @TODO: track @import from external CSS, avoiding circular @import\n            if ( l = l.cssRules ) {\n                _links = _links.concat( slice.call(l) );\n            }\n        }\n        if ( href ) {\n            a.hostname = hostname; // if href is relative, it should be relative to location\n            a.href = href;\n            href = a.href;\n            const { hostname: _hostname, pathname, search } = a;\n            const hosts = [_hostname];\n            const { hostAlias } = options;\n            const altHostname = hostAlias[_hostname];\n            if(altHostname) hosts.push(altHostname);\n\n            links = links.filter(function (l) {\n                let h = l.href;\n                if(!h) return;\n\n                a.href = h;\n                if(a.pathname != pathname) return;\n                if(search && a.search != search) return;\n\n                const _host = a.hostname;\n                if(!~hosts.indexOf(_host)) {\n                    const altAHostname = hostAlias[_host];\n                    if(!altAHostname || !~hosts.indexOf(altAHostname)) return;\n                }\n\n                return true;\n                // return ( h && h.indexOf(href) == 0 );\n            });\n        }\n        return links;\n    }\n\n    function getExt(url) {\n        a.href = url;\n        var pathname = a.pathname;\n        return pathname.split('.').pop();\n    }\n\n    function getPath(a, withOrigin) {\n        return (withOrigin?a.origin:'') + a.pathname+a.search.replace(ncReg, '');\n    }\n\n    function normPath(url, withOrigin) {\n        a.href = origin; // required for rel url\n        a.href = url;\n        if(withOrigin == undefined) {\n            const { hostAlias } = options;\n            const _host = a.hostname;\n            const _aHost = hostAlias && hostAlias[_host];\n            withOrigin = _host != hostname && (!_aHost || _aHost != hostname);\n        }\n        return getPath(a, withOrigin);\n    }\n\n    function getNCUrl(url, meth) {\n        var href = url.replace(ncReg, '');\n        if ( !meth || meth == 'HEAD' ) {\n            href += (href.indexOf('?') < 0 ? '?' : '&')+noCacheParam+'='+(now()&0x3FFFFF).toString(36);\n        }\n        return href;\n    }\n\n    function filtSrc(l) {\n        const href = l.src || l.href;\n        if ( !href ) return;\n        const ext = getExt(href);\n        const { wHosts, hostAlias } = options;\n\n        let _host = a.hostname;\n        let _aHost = hostAlias && hostAlias[_host];\n        // Unknown host\n        if(wHosts && wHosts.length) {\n            if ( wHosts.indexOf(_host) == -1 && (!_aHost || wHosts.indexOf(_aHost) == -1) ) {\n                return;\n            }\n        }\n        if ( options.noMin && a.pathname.indexOf('.min.') > 0 ) return;\n        return '.css.js'.indexOf(ext) > -1 && a.pathname.indexOf('/jasmine/lib/') == -1\n            ? getPath(a, _host != hostname && (!_aHost || _aHost != hostname))\n            : undefined;\n    }\n\n    function getETag(xhr, result) {\n        if ( xhr ) {\n            var headers = ['Content-Type', 'Content-Length', 'Last-Modified', 'ETag']\n            ,   ret = []\n            ,   i, h, v\n            ;\n            for ( i = headers.length; i--; ) {\n                if ( v = xhr.getResponseHeader(h = headers[i]) ) {\n                    // ETag alone is enough\n                    if ( h == 'ETag' ) {\n                        return v;\n                    }\n                    // Compact Last-Modified for fun and debug\n                    if ( h == 'Last-Modified' ) {\n                        v = (new Date(v) / 1e3).toString(36);\n                    }\n                    ret[i] = v;\n                }\n            }\n            if ( ret.length ) return ret.join('~');\n        }\n        return result;\n    }\n\n\n    function addURL(url, etag, altMethod) {\n        var inState = url in states;\n        if ( !inState ) {\n            list.push(url);\n        }\n        if ( altMethod ) {\n            types[url] = altMethod;\n        }\n        states[url] = etag;\n\n        return !inState;\n    }\n\n    function getState(url, ondone) {\n        if ( !url ) return;\n        if ( !(url in states) ) return request(options.defMethod, url\n          , function (result, status, xhr) {\n                var etag = getETag(xhr, result);\n                if ( !etag ) {\n                    request(options.altMethod, url\n                      , function (result, status, xhr) {\n                            var etag = getETag(xhr, result);\n                            ondone(url, etag, addURL(url, etag, options.altMethod));\n                        }\n                    );\n                }\n                else {\n                    ondone(url, etag, addURL(url, etag));\n                }\n            }\n        );\n    }\n\n    function debug() {\n        const { console } = win;\n        if ( console && console.debug ) {\n            debug = //jshint ignore:line\n            watchem.debug =\n            console.debug.bind(console);\n            return debug.apply(console, arguments);\n        }\n    }\n\n    function load_js(src, clb) {\n        let s = document.createElement('SCRIPT');\n        s.async = 1;\n        s.src = src;\n        let b = document.getElementsByTagName('script')[0];\n        s.onload = s.onreadystatechange = function (evt) {\n            if( s && (!(b=s.readyState)||b=='loaded'||b=='complete') ) {\n                if ( s ) {\n                    clb && clb.call(s, evt);\n                    if ( s.parentNode ) {\n                        s.parentNode.removeChild(s);\n                    }\n                    s = undefined;\n                }\n            }\n        };\n        b.parentNode.insertBefore(s, b);\n        return s;\n    }\n\n    init.version = version;\n\n    // AMD\n    if ( typeof define == 'function' && define.amd) {\n        init.watchem = watchem;\n        define([], init);\n    }\n    // Browser - global scope\n    else {\n        // Init with delay\n        initTo = setTimeout(init, options.interval);\n\n        // Catch new stuff on DOMContentLoaded & window.load\n        if(document.addEventListener) {\n            document.addEventListener('DOMContentLoaded', init);\n            win.addEventListener('load', init);\n        }\n\n        win.watchem = watchem;\n\n        const watchemInit = win.watchemInit;\n        if(watchemInit) watchemInit(watchem, options);\n    }\n}\n(typeof globalThis != 'undefined' ? globalThis : window));\n"],"names":["win","undefined","idx","runTo","initTo","$","JAJAX_URL","document","location","localStorage","setTimeout","clearTimeout","JSON","hostname","origin","list","extern","states","types","slice","a","createElement","ncReg","RegExp","options","interval","reDOM","wDoc","wCSS","wJS","noMin","hostAlias","wHosts","defMethod","altMethod","headers","watchem","stopped","stop","now","watchemStopped","start","files","init","run","watch","setOption","saveOptions","loadOptions","debug","jajax","jQuery","Zepto","ajax","src","clb","s","async","b","getElementsByTagName","onload","onreadystatechange","evt","readyState","call","parentNode","removeChild","insertBefore","load_js","opt","suc","err","Error","done","fail","href","candiates","concat","getStyleSheets","map","filtSrc","filter","identity","scripts","querySelectorAll","push","getPath","type","watchemToo","runAfter","asExtern","add","url","etag","added","replace","substr","Array","isArray","forEach","u","normPath","getState","Object","keys","length","i","request","result","status","xhr","_interval","getETag","ext","getExt","reload","links","link","pop","ownerNode","getNCUrl","error","delay","method","onsuc","onerr","dataType","bind","name","value","store","assign","stringify","_options","parse","Date","val","l","_links","styleSheets","cssRules","_hostname","pathname","search","hosts","altHostname","h","_host","indexOf","altAHostname","split","withOrigin","_aHost","meth","toString","v","ret","getResponseHeader","join","addURL","inState","ondone","console","apply","arguments","version","define","amd","addEventListener","watchemInit","globalThis","window"],"mappings":"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"}